@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 210 40% 98%;
    --foreground: 222 47% 11%;
    --card: 0 0% 100%;
    --card-foreground: 222 47% 11%;
    --popover: 0 0% 100%;
    --popover-foreground: 222 47% 11%;
    --primary: 221 83% 53%;
    --primary-foreground: 210 40% 98%;
    --secondary: 210 40% 96%;
    --secondary-foreground: 222 47% 11%;
    --muted: 210 40% 96%;
    --muted-foreground: 215 16% 47%;
    --accent: 210 40% 96%;
    --accent-foreground: 222 47% 11%;
    --destructive: 0 84% 60%;
    --destructive-foreground: 210 40% 98%;
    --border: 214 32% 91%;
    --input: 214 32% 91%;
    --ring: 221 83% 53%;
    --chart-1: 221 83% 53%;
    --chart-2: 142 76% 36%;
    --chart-3: 262 83% 58%;
    --chart-4: 32 95% 44%;
    --chart-5: 340 82% 52%;
    --radius: 0.75rem;
  }

  .dark {
    --background: 222 47% 11%;
    --foreground: 210 40% 98%;
    --card: 217 33% 17%;
    --card-foreground: 210 40% 98%;
    --popover: 217 33% 17%;
    --popover-foreground: 210 40% 98%;
    --primary: 217 91% 60%;
    --primary-foreground: 222 47% 11%;
    --secondary: 217 33% 17%;
    --secondary-foreground: 210 40% 98%;
    --muted: 223 47% 11%;
    --muted-foreground: 215 20% 65%;
    --accent: 217 33% 17%;
    --accent-foreground: 210 40% 98%;
    --destructive: 0 62% 30%;
    --destructive-foreground: 210 40% 98%;
    --border: 217 33% 17%;
    --input: 217 33% 17%;
    --ring: 224 76% 48%;
    --chart-1: 217 91% 60%;
    --chart-2: 142 76% 36%;
    --chart-3: 262 83% 58%;
    --chart-4: 32 95% 44%;
    --chart-5: 340 82% 52%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

@layer utilities {
  /* Animaciones suaves */
  .transition-smooth {
    @apply transition-all duration-300 ease-in-out;
  }
  
  .transition-fast {
    @apply transition-all duration-150 ease-in-out;
  }
  
  /* Efectos hover profesionales */
  .hover-lift {
    @apply transition-transform duration-300 hover:scale-105 hover:shadow-lg;
  }
  
  .hover-glow {
    @apply transition-shadow duration-300 hover:shadow-xl hover:shadow-primary/20;
  }
  
  /* Skeleton loader */
  .skeleton {
    @apply animate-pulse bg-muted rounded;
  }
  
  .skeleton-shimmer {
    @apply relative overflow-hidden bg-muted rounded;
  }
  
  .skeleton-shimmer::after {
    @apply absolute inset-0 -translate-x-full animate-shimmer bg-gradient-to-r from-transparent via-white/20 to-transparent;
    content: '';
  }
  
  /* Efectos de entrada */
  .fade-in {
    @apply animate-fade-in;
  }
  
  .fade-in-up {
    @apply animate-fade-in-up;
  }
  
  .scale-in {
    @apply animate-scale-in;
  }
}

/* Evitar auto-zoom en iOS Safari: deshabilitar ajuste automático de tamaño de texto */
html, body {
  -webkit-text-size-adjust: 100%; /* evita que iOS cambie el tamaño del texto automáticamente */
}

/* Mejorar el scroll en iOS - prevenir el rebote y comportamiento extraño */
@supports (-webkit-touch-callout: none) {
  /* Solo en iOS/Safari */
  html {
    height: 100%;
    overflow: auto;
  }
  
  body {
    height: 100%;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: none;
  }
  
  /* Asegurar que el main tenga el scroll correcto */
  main {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
  }
  
  /* Prevenir que elementos sticky causen scroll jump en iOS */
  .sticky {
    position: -webkit-sticky;
    position: sticky;
    /* Forzar GPU acceleration para mejor performance */
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    will-change: transform;
  }
  
  /* Asegurar que el contenedor del sticky no cause problemas */
  [class*="space-y"] {
    isolation: isolate;
  }
}

/*
  NOTA: aplicar font-size:16px global en inputs puede romper el layout (los campos se vuelven más grandes).
  En su lugar, aplica la corrección solo a las páginas/controles que la necesiten añadiendo la clase
  `no-ios-zoom` al contenedor principal de esa página (por ejemplo: <div class="no-ios-zoom">...form...</div>).
*/
.no-ios-zoom input,
.no-ios-zoom textarea,
.no-ios-zoom select,
.no-ios-zoom button,
/* mayor especificidad para el Input componente (usa data-slot) */
.no-ios-zoom input[data-slot="input"] {
  /* Forzamos 16px para evitar que iOS haga auto-zoom en focus. Se usa !important para sobreescribir utilidades de Tailwind si es necesario. */
  font-size: 16px !important;
  line-height: 1.2 !important;
}

/* Prevenir el desplazamiento/zoom al hacer focus en inputs en iOS */
.no-ios-zoom input:focus,
.no-ios-zoom textarea:focus,
.no-ios-zoom select:focus {
  /* Evitar que el teclado empuje el contenido fuera de la vista */
  position: relative;
  z-index: auto;
}

/* Asegurar que los diálogos no se muevan en iOS */
[data-slot="dialog-content"] {
  position: fixed !important;
  /* Mantener la posición centrada incluso cuando aparece el teclado */
  -webkit-overflow-scrolling: touch;
  /* Mejorar el scroll en iOS */
  overscroll-behavior: contain;
}

/* Prevenir que el viewport se ajuste cuando aparece el teclado en iOS */
@supports (-webkit-touch-callout: none) {
  /* Solo en iOS/Safari */
  [data-slot="dialog-content"] {
    /* Asegurar que el diálogo permanezca visible y no se desplace */
    max-height: 85vh !important;
    overflow-y: auto !important;
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    /* Usar will-change para mejor performance */
    will-change: transform;
  }
  
  /* Prevenir el scroll del body cuando el diálogo está abierto */
  body:has([data-slot="dialog-content"]) {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
  }
}

/* Corregir fondo gris de autofill en inputs (Chrome/Edge) usando variables de tema */
input[data-slot="input"]:-webkit-autofill,
textarea[data-slot="input"]:-webkit-autofill,
input[data-slot="input"]:-webkit-autofill:hover,
textarea[data-slot="input"]:-webkit-autofill:hover,
input[data-slot="input"]:-webkit-autofill:focus,
textarea[data-slot="input"]:-webkit-autofill:focus {
  -webkit-box-shadow: 0 0 0px 1000px hsl(var(--card)) inset !important;
  box-shadow: 0 0 0px 1000px hsl(var(--card)) inset !important;
  -webkit-text-fill-color: hsl(var(--card-foreground)) !important;
  caret-color: auto;
}

/* Compatibilidad adicional: selector general para inputs normales */
input:-webkit-autofill,
textarea:-webkit-autofill,
input:-webkit-autofill:hover,
textarea:-webkit-autofill:hover,
input:-webkit-autofill:focus,
textarea:-webkit-autofill:focus {
  -webkit-box-shadow: 0 0 0px 1000px hsl(var(--card)) inset !important;
  box-shadow: 0 0 0px 1000px hsl(var(--card)) inset !important;
  -webkit-text-fill-color: hsl(var(--card-foreground)) !important;
}

/* Forzar fondo consistente en inputs usando el color de la tarjeta (evita 'pills' grises) */
input[data-slot="input"],
textarea[data-slot="input"],
input[data-slot="input"]:not(:placeholder-shown),
textarea[data-slot="input"]:not(:placeholder-shown) {
  background-color: hsl(var(--card)) !important;
  -webkit-text-fill-color: hsl(var(--card-foreground)) !important;
  color: hsl(var(--card-foreground)) !important;
  box-shadow: none !important;
}

/* Asegurar que el autofill use el mismo fondo (Chrome/Edge) */
input[data-slot="input"]:-webkit-autofill,
textarea[data-slot="input"]:-webkit-autofill,
input[data-slot="input"]:-webkit-autofill:hover,
textarea[data-slot="input"]:-webkit-autofill:hover,
input[data-slot="input"]:-webkit-autofill:focus,
textarea[data-slot="input"]:-webkit-autofill:focus {
  -webkit-box-shadow: 0 0 0px 1000px hsl(var(--card)) inset !important;
  box-shadow: 0 0 0px 1000px hsl(var(--card)) inset !important;
  -webkit-text-fill-color: hsl(var(--card-foreground)) !important;
}

/* Eliminamos la regla global :focus que podía forzar transform/none y afectar animaciones/estilos */


/* Forzar apariencia del AlertDialog para que luzca igual en light/dark */
[data-slot="alert-dialog-overlay"] {
  background-color: rgba(0, 0, 0, 0.5);
  z-index: 200 !important;
}

/* Allow AlertDialog content to be themed by component tokens and dark: classes */
[data-slot="alert-dialog-content"] {
  /* intentionally left blank so AlertDialog component controls colors via tokens/dark classes */
  z-index: 200 !important;
}

/* In dark mode reduce overlay opacity slightly */
.dark [data-slot="alert-dialog-overlay"] {
  background-color: rgba(0, 0, 0, 0.2);
}

/* Mejorar scroll en formularios dentro de diálogos en iOS */
@supports (-webkit-touch-callout: none) {
  .no-ios-zoom {
    /* Prevenir rebote del scroll */
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
  }
  
  /* Asegurar que los inputs dentro del diálogo no causen scroll */
  .no-ios-zoom input:focus,
  .no-ios-zoom textarea:focus,
  .no-ios-zoom select:focus {
    /* Evitar que iOS mueva el viewport */
    scroll-margin-top: 100px;
    scroll-margin-bottom: 100px;
  }
  
  /* Prevenir scroll jump al interactuar con inputs en listas largas */
  input:not(.no-ios-zoom input),
  textarea:not(.no-ios-zoom textarea),
  select:not(.no-ios-zoom select) {
    /* No permitir que iOS haga scroll automático al hacer focus */
    scroll-behavior: auto;
  }
  
  /* Prevenir que las tarjetas causen scroll jump */
  [class*="grid"] {
    contain: layout style;
  }
}

/* Estilos exactos para la X (botón de cierre) en modo oscuro — opción 3 (verde tenue) */
.dark [toast-close] {
  color: #DFF7EA !important; /* X color */
  background-color: rgba(223, 247, 234, 0.2) !important; /* círculo tenue */
}
.dark [toast-close]:hover {
  background-color: rgba(223, 247, 234, 0.3) !important;
}

/* Reglas alternativas para el botón de Sonner si no tiene el atributo toast-close */
.dark .toaster .toast button[aria-label="Close"],
.dark .toaster .toast button[data-sonner-close] {
  color: #DFF7EA !important;
  background-color: rgba(223, 247, 234, 0.2) !important;
  border-radius: 9999px !important;
  padding: 0.25rem !important;
}
.dark .toaster .toast button[aria-label="Close"]:hover,
.dark .toaster .toast button[data-sonner-close]:hover {
  background-color: rgba(223, 247, 234, 0.3) !important;
}

/* Forzar color del SVG de la X dentro del botón de Sonner */
.dark .toaster .toast button[aria-label="Close"] svg,
.dark .toaster .toast button[data-sonner-close] svg,
.dark .toaster .toast [data-sonner-close] svg {
  fill: #DFF7EA !important;
  stroke: #DFF7EA !important;
}

/* Estilos para el CAPTCHA de Cloudflare Turnstile */
/* Asegurar que el iframe respete el tema de la aplicación */
iframe[src*="challenges.cloudflare.com"],
iframe[src*="turnstile"] {
  border-radius: 0.5rem !important;
  overflow: hidden !important;
}

/* Contenedor del Turnstile - modo claro */
[data-theme="light"] iframe[src*="challenges.cloudflare.com"],
[data-theme="light"] iframe[src*="turnstile"],
:not(.dark) iframe[src*="challenges.cloudflare.com"],
:not(.dark) iframe[src*="turnstile"] {
  background: white !important;
  border: 1px solid hsl(var(--border)) !important;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
}

/* Contenedor del Turnstile - modo oscuro */
.dark iframe[src*="challenges.cloudflare.com"],
.dark iframe[src*="turnstile"] {
  background: hsl(var(--card)) !important;
  border: 1px solid hsl(var(--border)) !important;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3) !important;
}

/* Mejorar la integración visual del captcha */
div:has(> iframe[src*="challenges.cloudflare.com"]),
div:has(> iframe[src*="turnstile"]) {
  display: flex !important;
  justify-content: center !important;
  align-items: center !important;
  padding: 0.5rem !important;
  border-radius: 0.75rem !important;
  background: transparent !important;
}

/* Asegurar que el captcha no se vea cortado en móviles */
@media (max-width: 640px) {
  iframe[src*="challenges.cloudflare.com"],
  iframe[src*="turnstile"] {
    max-width: 100% !important;
    transform: scale(0.95) !important;
    transform-origin: center !important;
  }
}
